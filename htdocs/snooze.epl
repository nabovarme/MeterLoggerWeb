<HTML>
<HEAD>
	<meta name="robots" content="noindex">
	<meta name="viewport" content="width=600, initial-scale=2">
	<TITLE>MeterLogger Snoozed</TITLE>
	<style type="text/css">
	.default {
		font-family: Verdana, Geneva, sans-serif;
	}
	.default-small {
		font-family: Verdana, Geneva, sans-serif;
		font-size: 50%;
	}
	.default-bold {
		font-family: Verdana, Geneva, sans-serif;
		font-weight: bold;
	}
	.default-highlight {
		font-family: Verdana, Geneva, sans-serif;
		background-color:#FFFF00;
	}
	</style>
	<script type="text/javascript">
		function snoozeAlarm(auth, snooze) {
			if (!auth) {
				document.getElementById('status').innerHTML = 'Missing auth key';
				return;
			}

			let url = '/api/snooze/' + encodeURIComponent(auth);
			if (snooze) url += '/' + encodeURIComponent(snooze);

			fetch(url)
				.then(response => response.json())
				.then(data => {
					console.log(data);
					let container = document.getElementById('status');
					if (data.authorized) {
						if (snooze) {
							container.innerHTML = 'Alarm snoozed for ' + (data.alarm.snooze_human || '') + '.';
						} else {
							container.innerHTML = 'Snooze alarm';
						}
					} else {
						container.innerHTML = data.error || 'Not found';
					}
				})
				.catch(err => {
					console.error(err);
					document.getElementById('status').innerHTML = 'Error contacting server';
				});
		}
	</script>
</HEAD>
<BODY>
	<div id="status" class="default"></div>

	<!-- Form to snooze alarm -->
	<div class="default">
		<span></span><br>
		<form id="snoozeForm" onsubmit="event.preventDefault(); snoozeAlarm(this.auth.value, this.snooze.value);">
			<select name="snooze">
				<option value="300">5 min</option>
				<option value="1800">30 min</option>
				<option value="3600">1 hour</option>
				<option value="86400">1 day</option>
				<option value="604800">1 week</option>
				<option value="2678400">1 month</option>
			</select>

			<input type="hidden" name="auth" value="[+ $fdat{auth} +]">
			<input type="submit" name="update" value="Snooze" style="width: 100px;">
		</form>
	</div>

	<script type="text/javascript">
		// Initial fetch to display current snooze or auth failure
		if ("[+ $fdat{auth} +]") {
			snoozeAlarm("[+ $fdat{auth} +]");
		} else {
			document.getElementById('status').innerHTML = 'Not found';
		}
	</script>
</BODY>
</HTML>
